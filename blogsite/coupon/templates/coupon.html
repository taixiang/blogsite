{% extends "base_coupon.html" %}
{% load staticfiles %}


{% block content %}

<div class="am-g am-imglist">
    <ul id="coupon_content" data-am-widget="gallery" class="am-gallery am-avg-sm-2
  am-avg-md-3 am-avg-lg-6 am-gallery-default">

        {% for coupon in coupon_list %}
        <li>
            <div class="am-gallery-item am_list_block">

                <a href="{% url 'coupon:detail' coupon.uuid %}">
                    <div class="am_img_bg">
                        <img class="am_img animated" src="{% static 'img/loading.gif' %}"
                             data-original=""
                             alt="优惠券"/>
                    </div>
                    <span class="coupon_name">{{coupon.name}}</span>

                    <div>
                        <img class="img_juan" src="{% static 'img/coupon/juan.png' %}">

                        <span class="coupon_rule">{{coupon.rule}}</span>
                    </div>

                    <div class="am_listimg_info">
                        {% if coupon.price %}
                        <span class="ori_price">原价：<span
                                class="ori_font">￥</span><span
                                class="coupon_price">{{coupon.price}}</span></span>
                        {% endif %}
                    </div>
                    <div>
                        <div class="coupon_shop">{{coupon.shop}}</div>
                    </div>
                    <div id="{{coupon.id}}"  class="coupon_get_div"  data-clipboard-action="copy" value="{{ coupon.phone_url }}"
                         data-clipboard-target="div">
                        <a class="coupon_url">
                            <span id="coupon_get" class="coupon_get">立即领取</span>
                        </a>
                    </div>

                </a>
            </div>
        </li>

        {% endfor %}

    </ul>
</div>

{% if has_next %}
<div id="moreCoupon" class="am_news_load">
      <span style="color:#333">
          <i class="am-icon-spinner"></i> 查看更多</span>
</div>
{% endif %}

<div class="am-modal am-modal-no-btn" tabindex="-1" id="doc-modal-1">
    <div class="am-modal-dialog">
        <div class="am-modal-hd">提示
            <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
        </div>
        <div class="am-modal-bd">
            链接复制成功，打开手机自带浏览器 粘贴访问可以领取！
        </div>
    </div>
</div>

<div style="height:50px"></div>


<script src="{% static 'js/petshow.js' %}"></script>

<script src="{% static 'js/coupon/couponjs.js' %}"></script>
<script src="{% static 'js/clipboard.min.js' %}"></script>

<script>

    var page = 2;
    var type = "";

    if("{{type}}" == "up" || "{{type}}" == "down"){
        type = "{{type}}"
    }

    console.log(type)

    if(Util.isWeixin()){
        $("#coupon_content").parent().find(".coupon_get").text("复制链接");
        $(".coupon_url").attr("data-am-modal","{target: '#doc-modal-1', closeViaDimmer: 0, width: 300, height: 225}");
        var clipboard = new ClipboardJS('.coupon_get_div', {
                                            text: function(trigger) {
                                            console.log(trigger)
                                            console.log(trigger.getAttribute('value'))
                                                return trigger.getAttribute('value');
                                            }
                                        });

        clipboard.on('success', function(e) {
            });

        clipboard.on('error', function(e) {
            });
    }else{
        $(".coupon_get_div").attr("onclick","cc(this)");

    }

    $("#moreCoupon").click(function(){
        $(".am-icon-spinner").addClass("am-icon-spin");
        $.ajax({
            type:"GET",
            url:'{% url 'coupon:more_coupon' %}?page='+page + '&type='+type,
            dataType:'json',
            success:function(response, status){

            }
        })

    })

    $("#price_tab").click(function(){
        console.log("==============")
        var type = "{{ type }}"
        console.log(type)
        if(type == "down"){
            type = "up"
        }else if( type != null){
            type = "down"
            console.log("=111111==========")
        }
        window.location.href = "{% url 'coupon:type_list' 0 %}".replace('0', type)
    })


    function cc(e){
        window.open(e.getAttribute("value"))
    }

</script>

{% endblock %}


