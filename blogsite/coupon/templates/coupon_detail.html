{% extends "base_coupon.html" %}
{% load staticfiles %}

{% block content %}

<style>
    body{
        font-family:Arial, "Microsoft Yahei";
    }

    .detail_txt{
        width: 100%;
    padding: 8px 22px;
    font-size: 16px;
    color: #222;
    border-bottom: 1px solid #e9e9e9;
    }




</style>

<div class="am_tuya">


    <div class="am_tuya_content">
        <div class="am_tuya_content_l">
            <div class="am_tuya_more">
                <div class="detail_txt">
                    <div style="display:inline">
                        <img class="img_juan" src="{% static 'img/coupon/juan.png' %}">
                        <span class="coupon_rule">{{detail.rule}}</span>
                    </div>

                    <div style="display:inline;float:right" class="coupon_get_div" data-clipboard-action="copy"
                         data-clipboard-target="div">
                        <a class="coupon_url">
                            <span id="coupon_get" class="coupon_get">立即领取</span>
                        </a>
                    </div>

                </div>
                <div class="detail_txt">{{detail.name}}</div>
                <div class="detail_txt">{{detail.shop}}</div>
                <div class="detail_txt">原价：￥{{detail.price}}
                    <div style="display:inline;float:right" class="coupon_get_div">
                        <a href="{{detail.detail_url}}" target="_blank">
                            <span id="detail_get" class="coupon_get">商品链接</span>
                        </a>
                    </div>
                </div>

            </div>
            <div class="am_albums">
                <img class="am_img animated" width="100%" height="100%"
                     src="{{detail.img}}"
                     alt="优惠券"/>
            </div>

        </div>
    </div>

    <div class="am-modal am-modal-no-btn" tabindex="-1" id="doc-modal-1">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">提示
                <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
            </div>
            <div class="am-modal-bd">
                链接复制成功，打开手机自带浏览器 粘贴访问可以领取！
            </div>
        </div>
    </div>

</div>

<script src="{% static 'js/coupon/couponjs.js' %}"></script>

<script src="{% static 'js/clipboard.min.js' %}"></script>

<script>
    console.log("===========")
    console.log(Util.isWeixin())
    console.log(Util.isMobile())

    if(Util.isWeixin()){
        $("#coupon_get").text("复制链接");
        $(".coupon_url").attr("data-am-modal","{target: '#doc-modal-1', closeViaDimmer: 0, width: 300, height: 125}");
        var clipboard = new ClipboardJS('.coupon_get_div', {
                                            text: function(trigger) {
                                                return "{{ detail.phone_url }}";
                                            }
                                        });

        clipboard.on('success', function(e) {
                console.log('success');
                console.log(e);
            });

        clipboard.on('error', function(e) {
                console.log('fail');
                console.log(e);
            });

    }else {
        $(".coupon_url").attr("href","{{ detail.phone_url }}");
        $(".coupon_url").attr("target","_blank");

    }

    $("#price_tab").click(function(){
        console.log("==============")
        var type = "{{ type }}"
        console.log(type)
        if(type == "down"){
            type = "up"
        }else if( type != null){
            type = "down"
            console.log("=111111==========")
        }
        window.location.href = "{% url 'coupon:type_list' 0 %}".replace('0', type)
    })



</script>

{% endblock %}
